# Generated by Ansible (mirrors current lb-vm rules)

*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

-A FORWARD -i {{ lb_lan_if }} -o {{ lb_wan_if }} -j ACCEPT
-A FORWARD -i {{ lb_wan_if }} -o {{ lb_lan_if }} -m state --state RELATED,ESTABLISHED -j ACCEPT

-A FORWARD -s {{ opx_pc_ip }}/32 -d {{ mgmt_vm_ip }}/32 -i {{ lb_wan_if }} -o {{ lb_lan_if }} -p icmp -j ACCEPT
-A FORWARD -s {{ opx_pc_ip }}/32 -d {{ mgmt_vm_ip }}/32 -i {{ lb_wan_if }} -o {{ lb_lan_if }} -p tcp -m tcp --dport 22 -j ACCEPT
-A FORWARD -s {{ mgmt_vm_ip }}/32 -d {{ opx_pc_ip }}/32 -i {{ lb_lan_if }} -o {{ lb_wan_if }} -j ACCEPT
-A FORWARD -s {{ mgmt_vm_ip }}/32 -d {{ opx_pc_ip }}/32 -i {{ lb_lan_if }} -o {{ lb_wan_if }} -m state --state RELATED,ESTABLISHED -j ACCEPT

COMMIT

*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]

-A POSTROUTING -o {{ lb_wan_if }} -j MASQUERADE
-A POSTROUTING -s {{ mgmt_subnet_cidr }} -o {{ lb_wan_if }} -j MASQUERADE

COMMIT
